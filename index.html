<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ç”Ÿæ—¥å¿«ä¹ â€” ç²‰å½©ç¥ç¦</title>
  <style>
  :root{--bg:#fff0f6;--soft:#ffe6f0;--pink:#ffb6d5;--text:#6b3450}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:linear-gradient(180deg,var(--bg),#fff);color:var(--text);display:flex;align-items:center;justify-content:center;padding:12px}
  .card{width:380px;height:720px;border-radius:18px;background:linear-gradient(180deg,var(--soft),#fff);box-shadow:0 16px 40px rgba(107,52,80,0.12);position:relative;overflow:hidden}
  .top-deco{position:absolute;inset:0;pointer-events:none;background-image:radial-gradient(circle at 12% 12%, rgba(255,182,213,0.12), transparent 6%)}
  .cat{position:absolute;left:16px;top:12px;width:64px;height:64px}
  .stage{position:absolute;left:0;right:0;top:64px;bottom:160px;display:flex;align-items:center;justify-content:center}
  .cake{position:relative;width:260px;height:200px;display:flex;flex-direction:column;align-items:center}
  .cake-bottom{width:240px;height:120px;background:#ffd1e6;border-radius:20px 20px 14px 14px;box-shadow:inset 0 -10px 12px rgba(255,255,255,0.3)}
  .cake-top{position:relative;top:-40px;width:220px;height:68px;background:#fff;border-radius:34px;box-shadow:inset 0 -6px 10px rgba(255,0,120,0.04)}
  .candle{position:absolute;left:50%;top:-20px;transform:translateX(-50%);width:22px;height:56px;background:linear-gradient(#fff,#ffd4e6);border-radius:8px;display:flex;align-items:flex-start;justify-content:center;cursor:pointer}
  .candle:active{transform:translateX(-50%) scale(.98)}
  .flame{width:16px;height:20px;margin-top:-10px;border-radius:50%;background:linear-gradient(#ffd36a,#ff6b6b);opacity:0;transform:translateY(8px) scale(.6);transition:all .35s}
  .hint{position:absolute;bottom:140px;width:100%;text-align:center;font-weight:700;color:#b14b6a}
  .start-overlay{position:absolute;left:0;right:0;top:0;bottom:0;display:flex;align-items:center;justify-content:center;pointer-events:auto}
  .start-btn{background:linear-gradient(135deg,#ff84b6,#ffb6d5);padding:12px 20px;border-radius:999px;color:white;font-weight:800;box-shadow:0 8px 22px rgba(203,81,122,0.14);cursor:pointer}
  .art-text{position:absolute;bottom:160px;width:100%;text-align:center;font-size:34px;color:#ff4d88;font-weight:900;letter-spacing:2px;opacity:0;transform:translateY(8px) scale(.95);transition:all .6s}
  .art-text.show{opacity:1;transform:translateY(0) scale(1)}
  .slideshow{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
  .photo-popup{position:absolute;width:86%;height:60%;border-radius:14px;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 22px 60px rgba(107,52,80,0.18);
    /* æ–°å¢/ä¿®æ”¹ï¼šä¼˜åŒ–è¿‡æ¸¡æ•ˆæœï¼Œå®ç°æ·¡å…¥æ·¡å‡º */
    opacity:0;
    transform:translateY(10px) scale(.96);
    transition:all 0.8s ease; /* å»¶é•¿è¿‡æ¸¡æ—¶é—´ï¼Œæ›´å¹³æ»‘ */
  }
  .photo-popup.show{opacity:1;transform:translateY(0) scale(1)}
  .photo-popup img{width:100%;height:100%;object-fit:cover;border-radius:12px;
    /* å›¾ç‰‡è‡ªèº«ä¹ŸåŠ æ·¡å…¥è¿‡æ¸¡ */
    transition:opacity 0.8s ease;
  }
  .wish{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(255,240,248,0.95),rgba(255,250,250,0.98));opacity:0;pointer-events:none;transition:opacity .45s}
  .wish.show{opacity:1;pointer-events:auto}
  .wish-card{background:linear-gradient(180deg,#fff,#ffeef6);padding:22px;border-radius:16px;box-shadow:0 10px 30px rgba(203,81,122,0.12);text-align:center}
  .wish-card h1{margin:0;color:#ff4d88}
  .btn{margin-top:12px;padding:8px 14px;border-radius:10px;border:none;background:var(--pink);color:white}
  .footer{position:absolute;left:0;right:0;bottom:18px;text-align:center;color:#b14b6a;font-weight:700}
  </style>
</head>
<body>
  <div class="card" id="card">
    <div class="top-deco"></div>
    <svg class="cat" viewBox="0 0 64 64" aria-hidden>
      <circle cx="32" cy="32" r="28" fill="#fff" stroke="#ff8fb3" stroke-width="2" />
      <circle cx="22" cy="28" r="3" fill="#6b3450"/>
      <circle cx="42" cy="28" r="3" fill="#6b3450"/>
      <path d="M46 12c0 6-8 6-8 0 0-3 4-6 8-6 0 2 0 3 0 6z" fill="#ff7aa2"/>
    </svg>

    <div class="stage" id="stage">
      <div id="cake" class="cake" aria-label="ç”Ÿæ—¥è›‹ç³•">
        <div class="cake-bottom"></div>
        <div class="cake-top">
          <div class="candle" id="candle" role="button" tabindex="0">
            <div class="flame" id="flame"></div>
          </div>
        </div>
      </div>
      <div id="art" class="art-text">ç”Ÿæ—¥å¿«ä¹</div>
      <div id="photoLayer" class="slideshow"></div>
    </div>

    <div id="wish" class="wish" role="dialog">
      <div class="wish-card">
        <h1>ç¥ä½ ç”Ÿæ—¥å¿«ä¹ ğŸ‰</h1>
        <p id="wish-text">ç¬‘é¢œèƒœæ˜¥é˜³ï¼Œæ­¥å±¥å¸¦èŠ±é¦™ã€‚æ„¿å¹´å¹´ä»Šæœï¼Œä¸å…‰åŒåœ¨ä½ èº«æ—ã€‚</p>
        <button id="replay" class="btn">å†çœ‹ä¸€æ¬¡</button>
      </div>
    </div>

    <div class="hint" id="hint">è½»è§¦è›‹ç³•ç‚¹ç‡ƒèœ¡çƒ›</div>

    <div class="start-overlay" id="startOverlay">
      <div class="start-btn" id="startBtn">ç‚¹æˆ‘ä¸ºä½ åº†ç”Ÿ</div>
    </div>

    <audio id="birthdayAudio" src="ç”Ÿæ—¥å¿«ä¹æ­Œ.mp3" loop preload="auto"></audio>
    <div class="footer">å¼ æ›¾åªšç”Ÿæ—¥å¿«ä¹</div>
  </div>

  <script>
  (function(){
    const startOverlay = document.getElementById('startOverlay');
    const startBtn = document.getElementById('startBtn');
    const candle = document.getElementById('candle');
    const flame = document.getElementById('flame');
    const hint = document.getElementById('hint');
    const art = document.getElementById('art');
    const photoLayer = document.getElementById('photoLayer');
    const wish = document.getElementById('wish');
    const replay = document.getElementById('replay');

    // placeholder photos (SVG data URLs) â€” replace with real images if desired
    const photos = ['photo1.jpg','photo2.jpg','photo3.jpg','photo4.jpg','photo5.jpg','photo6.jpg','photo7.jpg','photo8.jpg'];

    let audioCtx=null, musicStarted=false, photoTimer=null, photoIndex=0, musicIntervalId=null;

    function ensureAudio() {
      // æ— éœ€åˆ›å»º AudioContextï¼Œæ”¹ç”¨ audio å…ƒç´ 
    }

    function startMusicLoop() {
      if (musicStarted) return;
      musicStarted = true;
      const audio = document.getElementById('birthdayAudio');
      audio.play().catch(err => {
          console.log('æ’­æ”¾å¤±è´¥ï¼š', err);
       // å…¼å®¹ç§»åŠ¨ç«¯éœ€è¦ç”¨æˆ·äº¤äº’åæ’­æ”¾çš„é™åˆ¶
      });
    }

    // åˆå¹¶é‡å¤çš„replayäº‹ä»¶ï¼Œä¿®å¤é€»è¾‘
    replay.addEventListener('click', ()=>{
       wish.classList.remove('show'); 
       art.classList.remove('show'); 
       photoLayer.innerHTML=''; 
       flame.style.opacity=0; 
       flame.style.transform='translateY(8px) scale(.6)'; 
       hint.style.opacity=1; 
       startOverlay.style.display='flex';
       if(photoTimer){ clearInterval(photoTimer); photoTimer=null; }
       // åœæ­¢éŸ³é¢‘å¹¶é‡ç½®
       const audio = document.getElementById('birthdayAudio');
       audio.pause();
       audio.currentTime = 0;
       musicStarted = false;
    });

    function revealArt(){ art.classList.add('show'); }

    function showPhotoSequence(){
      photoIndex=0; 
      photoLayer.innerHTML=''; 
      const popup = document.createElement('div'); 
      popup.className='photo-popup'; 
      const img=document.createElement('img'); 
      popup.appendChild(img); 
      photoLayer.appendChild(popup);

      // å…ˆæ˜¾ç¤ºç¬¬ä¸€å¼ å›¾ç‰‡
      img.src = photos[photoIndex];
      popup.classList.add('show');
      photoIndex++;

      // ä¿®æ”¹å®šæ—¶å™¨ï¼š5ç§’åˆ‡æ¢ä¸€æ¬¡ï¼ˆ5000æ¯«ç§’ï¼‰
      photoTimer = setInterval(()=>{
        if(photoIndex>=photos.length){ 
          clearInterval(photoTimer); 
          photoTimer=null; 
          // æ·¡å‡ºå½“å‰å›¾ç‰‡åéšè—
          popup.classList.remove('show'); 
          setTimeout(()=>{ 
            photoLayer.innerHTML=''; 
            showWish(); 
          },800); // ç­‰å¾…è¿‡æ¸¡å®Œæˆï¼ˆä¸CSSè¿‡æ¸¡æ—¶é—´ä¸€è‡´ï¼‰
          return; 
        }

        // å…ˆæ·¡å‡ºå½“å‰å›¾ç‰‡
        popup.classList.remove('show');
        // ç­‰å¾…æ·¡å‡ºå®Œæˆåæ›´æ¢å›¾ç‰‡å¹¶æ·¡å…¥
        setTimeout(()=>{
          img.src = photos[photoIndex];
          popup.classList.add('show');
          photoIndex++;
        },800); // ç­‰å¾…è¿‡æ¸¡å®Œæˆï¼ˆä¸CSSè¿‡æ¸¡æ—¶é—´ä¸€è‡´ï¼‰
      },3000); // æ¯å¼ å›¾ç‰‡å±•ç¤º5ç§’
    }

    function showWish(){ wish.classList.add('show'); }

    function startSequence(){
      startOverlay.style.display='none'; 
      flame.style.opacity=1; 
      flame.style.transform='translateY(0) scale(1)'; 
      hint.style.opacity=0;
      ensureAudio(); 
      if(audioCtx && audioCtx.state==='suspended') audioCtx.resume().then(()=>startMusicLoop()).catch(()=>startMusicLoop()); 
      else startMusicLoop();
      setTimeout(revealArt,5000); 
      setTimeout(showPhotoSequence,10000);
    }

    // äº‹ä»¶ç»‘å®š
    startBtn.addEventListener('click', startSequence);
    startBtn.addEventListener('touchstart', (e)=>{ e.preventDefault(); startSequence(); }, {passive:false});
    candle.addEventListener('click', ()=>{ if(startOverlay.style.display!=='none') startSequence(); });
    candle.addEventListener('touchstart', (e)=>{ e.preventDefault(); if(startOverlay.style.display!=='none') startSequence(); }, {passive:false});

    // keyboard accessibility
    candle.addEventListener('keypress', (e)=>{ if(e.key==='Enter' || e.key===' ') startSequence(); });
  })();
  </script>
</body>
</html>